{% extends "base.html" %}
{% block content %}
<div class="card mb-4 border-0 shadow-sm">
    <div class="card-body p-4">
        <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 64px; height: 64px; font-size: 24px;">
                    {{ patient.name[0] | upper }}
                </div>
                <div>
                    <h2 class="mb-1">{{ patient.name }}</h2>
                    <div class="text-muted small">
                        <span class="me-3">ID: #{{ patient.id }}</span>
                        {% if patient.phone %}<span class="me-3">ğŸ“ {{ patient.phone }}</span>{% endif %}
                        {% if patient.dob %}<span class="me-3">ğŸ‚ {{ patient.dob }}</span>{% endif %}
                        {% if patient.gender %}<span class="me-3">ğŸ‘¤ {{ patient.gender }}</span>{% endif %}
                    </div>
                </div>
            </div>
            <a href="{{ url_for('doctor_dashboard') }}" class="btn btn-outline-secondary">â† Back to Dashboard</a>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Reports / Scans Section (Most important often) -->
    <div class="col-12">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white py-3">
                <h5 class="mb-0 text-primary">ğŸ“‹ Reports & Scans</h5>
            </div>
            <div class="card-body p-0">
                {% if reports %}
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Date</th>
                                <th>Type</th>
                                <th>Details</th>
                                <th>Added By</th>
                                <th>Attachment</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for r in reports %}
                            <tr>
                                <td class="text-muted">{{ r.created_at.split(' ')[0] }}</td>
                                <td><span class="badge bg-info text-dark">{{ r.report_type }}</span></td>
                                <td>{{ r.report_text or "" }}</td>
                                <td>{{ r.staff_name }} ({{ r.staff_role|capitalize }})</td>
                                <td>
                                    {% if r.image_filename %}
                                        <a class="btn btn-sm btn-outline-primary" href="{{ url_for('uploads', filename=r.image_filename) }}" target="_blank">
                                            View File
                                        </a>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                    <div class="text-center py-5 text-muted bg-light">
                        <p class="mb-0">No reports or scans found for this patient.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Active Assignments -->
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
             <div class="card-header bg-white py-3">
                <h5 class="mb-0 text-success">ğŸ©º Tasks & Assignments</h5>
            </div>
            <div class="card-body p-0">
                {% if assignments %}
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light"><tr><th>Task</th><th>Assignee</th><th>Status</th></tr></thead>
                        <tbody>
                            {% for a in assignments %}
                            <tr>
                                <td>
                                    <div class="fw-bold">{{ a.task_type }}</div>
                                    <div class="text-muted small">{{ a.created_at.split(' ')[0] }}</div>
                                </td>
                                <td>{{ a.assignee_name }}<br><span class="text-muted small">{{ a.assignee_role|capitalize }}</span></td>
                                <td>
                                    <span class="badge bg-{{ 'success' if a.status == 'Completed' else 'warning' if a.status == 'In Progress' else 'secondary' }}">
                                        {{ a.status }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                    <div class="text-center py-5 text-muted bg-light">No active tasks.</div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Doctor Orders -->
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
             <div class="card-header bg-white py-3">
                <h5 class="mb-0 text-warning text-dark">ğŸ“ Clinical Orders</h5>
            </div>
            <div class="card-body p-0">
                {% if orders %}
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead class="table-light"><tr><th>Order</th><th>Doctor</th><th>Notes</th></tr></thead>
                        <tbody>
                            {% for o in orders %}
                            <tr>
                                <td>
                                    <div class="fw-bold">{{ o.order_type }}</div>
                                    <div class="text-muted small">{{ o.created_at.split(' ')[0] }}</div>
                                </td>
                                <td>{{ o.doctor_name }}</td>
                                <td>{{ o.notes or "-" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                    <div class="text-center py-5 text-muted bg-light">No orders yet.</div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
